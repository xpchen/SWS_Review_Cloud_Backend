# 登录接口404问题排查指南

## 问题描述
调用 `POST http://0.0.0.0:8000/api/auth/login` 返回404

## 排查步骤

### 1. 确认服务是否正在运行

**检查方法：**
```bash
# 方法1：访问健康检查接口
curl http://localhost:8000/health
# 或
curl http://0.0.0.0:8000/health

# 方法2：访问API文档
浏览器打开: http://localhost:8000/docs
```

**预期结果：**
- `/health` 应返回 `{"code": "OK", "message": "success", "data": {"status": "up"}}`
- `/docs` 应显示FastAPI自动生成的API文档

**如果返回连接错误：**
- 服务未启动，需要先启动服务

### 2. 检查服务启动日志

**查看是否有导入错误：**
```bash
# 如果使用uvicorn直接启动，查看终端输出
# 如果使用docker，查看容器日志
docker logs <container_name>
```

**常见错误：**
- `ModuleNotFoundError: No module named 'fastapi'` → 需要安装依赖
- `ImportError: cannot import name 'export_router'` → 需要重启服务（已修复）

### 3. 确认路由是否正确注册

**检查方法：**
访问 `http://localhost:8000/docs`，查看是否有 `/api/auth/login` 接口

**如果看不到登录接口：**
- 服务可能启动失败
- 需要重启服务以加载最新的代码

### 4. 正确的请求方式

**Postman配置：**
- **Method**: POST
- **URL**: `http://localhost:8000/api/auth/login` 或 `http://0.0.0.0:8000/api/auth/login`
- **Headers**: 
  ```
  Content-Type: application/json
  ```
- **Body** (raw JSON):
  ```json
  {
    "username": "your_username",
    "password": "your_password"
  }
  ```

### 5. 重启服务

**如果代码已修复但服务未重启：**

```bash
# 如果使用uvicorn
# 1. 停止当前服务（Ctrl+C）
# 2. 重新启动
cd SWS_Review_Cloud_Backend_MVP
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# 如果使用docker
docker-compose restart api
# 或
docker restart <container_name>
```

### 6. 验证路由配置

**代码检查：**
- ✅ `app/routers/auth.py` 中定义了 `router = APIRouter(prefix="/api/auth")`
- ✅ `app/routers/auth.py` 中有 `@router.post("/login")`
- ✅ `app/main.py` 中已注册 `app.include_router(auth.router)`
- ✅ `app/main.py` 中已导入 `from .routers import auth, ..., export_router`

**所有配置都已正确，问题很可能是服务未重启**

### 7. 测试其他接口

**如果登录接口404，测试其他接口：**
```bash
# 健康检查
GET http://localhost:8000/health

# API文档
GET http://localhost:8000/docs

# OpenAPI JSON
GET http://localhost:8000/openapi.json
```

**如果这些接口都404：**
- 服务根本没有启动
- 端口被占用
- 防火墙/网络问题

### 8. 检查端口占用

```bash
# Windows
netstat -ano | findstr :8000

# 如果端口被占用，可以：
# 1. 停止占用端口的进程
# 2. 或修改服务端口（修改uvicorn命令中的--port参数）
```

## 快速修复步骤

1. **停止当前服务**（如果正在运行）
2. **确认代码正确**（已确认export_router已导入）
3. **重新启动服务**：
   ```bash
   cd SWS_Review_Cloud_Backend_MVP
   uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```
4. **等待服务启动完成**（看到 "Uvicorn running on http://0.0.0.0:8000"）
5. **测试健康检查**：`GET http://localhost:8000/health`
6. **测试登录接口**：`POST http://localhost:8000/api/auth/login`

## 常见问题

### Q: 为什么修改代码后接口还是404？
A: FastAPI需要重启才能加载新代码。如果使用 `--reload` 参数，代码修改后会自动重启，但如果是导入错误导致启动失败，需要手动重启。

### Q: 使用0.0.0.0和localhost有什么区别？
A: 
- `0.0.0.0` 表示监听所有网络接口，可以从其他机器访问
- `localhost` 或 `127.0.0.1` 只能从本机访问
- 两者都可以，但建议使用 `localhost` 进行本地测试

### Q: 如何确认服务是否正常启动？
A: 查看启动日志，应该看到类似输出：
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

如果没有看到这些日志，说明服务启动失败，需要检查错误信息。
